#!/bin/bash
guard() {
if [[ $PACSTALL_DIRECTORY = " " ]] ; then
  echo "It seems you've unset your pacstall config directory"
  exit 1
fi
}
while test $# -gt 0; do
  case "$1" in
    -h|--help)
      echo " "
      echo "options:"
      echo "-I --install, Installs package"
      echo "-S --search, Search for package"
      echo "-R --remove, Removes package"
      echo "-C --change-repo, Chooses repo"
      echo "-U --update, Update script"
      echo "-V --version, Prints pacstall version"
      echo "-L --list, Lists installed packages"
      echo " "
      exit 0
      ;;
    -I|--install)
      INPUT=$1
      echo $INPUT > /tmp/pacstalling
      if grep -q @ /tmp/pacstalling; then
          PACKAGE=$(cut -d@ -f1 /tmp/pacstalling)
          VERSION=$(cut -d@ -f2- /tmp/pacstalling)
      else
          PACKAGE=$INPUT
          VERSION=master
      fi
      REPO=$(cat /usr/share/pacstall/repo/pacstallrepo.txt)
      URL="https://raw.githubusercontent.com/$REPO/1.0.4-Celeste/packages/$PACKAGE/$VERSION/PACSCRIPT"
      sudo bash /usr/share/pacstall/scripts/download.sh
      
      ;;
    -S|--search)
      . /usr/share/pacstall/scripts/search.sh
      ;;
    -R|--remove)
      PACKAGE=$2
      sudo apt remove $PACKAGE
      ;;
    -C|--change-repo)
      . /usr/share/pacstall/scripts/change-repo.sh
      ;;
    -V|--version)
      COLOR='\e[1;36m'
      NC='\033[0m' # No Color
      echo -e "1.0.4 ${COLOR}Celeste${NC}"
      exit 0
      ;;
    -U|--update)
      sudo wget -q https://raw.githubusercontent.com/Henryws/pacstall/master/pacstall -O /bin/pacstall
      
      sudo wget -q https://raw.githubusercontent.com/Henryws/pacstall/master/misc/scripts/install.sh -O /usr/share/pacstall/scripts/install.sh
      sudo wget -q https://raw.githubusercontent.com/Henryws/pacstall/master/misc/scripts/search.sh -O /usr/share/pacstall/scripts/search.sh
      sudo wget -q https://raw.githubusercontent.com/Henryws/pacstall/master/misc/scripts/change-repo.sh -O /usr/share/pacstall/scripts/change-repo.sh
      
      echo "Updating complete"
      echo "You are at version $(pacstall -V)"
      exit 0
      ;;
    -Ud|--update-dev)
      UPDATEBRANCH=1.0.4-Celeste
      sudo pacstall -U
      sudo sed -i 's/master/'"$UPDATEBRANCH"'/g' /bin/pacstall
      exit
      ;;
    -L|--list)
      wc -l /var/log/pacstall_installed
      cat /var/log/pacstall_installed
      exit 0
      ;;
    -Iu|--install-updates)
      BLUE='\033[0;34m'
      NC='\033[0m'
      echo "Scanning ${BLUE}/var/cache/pacstall/auto${NC}"
      UPDATES=$(cat /var/cache/pacstall/auto | tr "\n" " ")
      sudo pacstall -I $UPDATES
      exit
      ;;
    -D|--download)
      PACKAGE=$1
      REPO=$(cat /usr/share/pacstall/repo/pacstallrepo.txt)
      . /usr/share/pacstall/scripts/download.sh
      ;;
     *)
      pacstall -h
      break
      ;;
  esac
done 
